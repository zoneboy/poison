<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Football Predictor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      window.process = { env: { NODE_ENV: 'production' } };
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              neon: { 400: '#4ade80', 500: '#22c55e', 900: '#14532d' }
            },
            animation: { 'spin-slow': 'spin 3s linear infinite' }
          }
        }
      }
    </script>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "clsx": "https://esm.sh/clsx@2.1.0",
        "lucide-react": "https://esm.sh/lucide-react@0.368.0"
      }
    }
    </script>
    <style>
      body { 
        font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
        color: rgb(255, 255, 255);
        background: linear-gradient(to bottom, transparent, rgb(0, 0, 0)) rgb(10, 10, 10);
        min-height: 100vh;
      }
      ::-webkit-scrollbar { width: 8px; height: 8px; }
      ::-webkit-scrollbar-track { background: #0f172a; }
      ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #475569; }
    </style>
</head>
<body class="bg-black text-slate-200">
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { clsx } from 'clsx';
        import { 
            Trash2, Plus, Database, ShieldCheck, Pencil, X, Save, 
            Loader2, Calculator, AlertTriangle, Terminal, Home as HomeIcon,
            TrendingUp, TrendingDown, Minus, Target, Users, DollarSign, LineChart
        } from 'lucide-react';

        // --- API CLIENT ---
        const api = async (action, payload = {}) => {
            try {
                const res = await fetch('/.netlify/functions/api', { 
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action, payload })
                });
                
                const contentType = res.headers.get("content-type");
                if (!contentType || !contentType.includes("application/json")) {
                    const text = await res.text();
                    console.error("Fatal Server Error (Non-JSON):", text);
                    
                    let errorMsg = "Server connection failed.";
                    const titleMatch = text.match(/<title>(.*?)<\/title>/i);
                    if (titleMatch) errorMsg += ` (${titleMatch[1]})`;
                    
                    if (res.status === 502) errorMsg = "Server Timeout (502). The database might be sleeping.";
                    if (res.status === 500) errorMsg = "Internal Server Error (500). Check Function Logs.";
                    
                    throw new Error(errorMsg);
                }

                const data = await res.json();
                if (!res.ok) throw new Error(data.error || 'Server Error');
                return data;
            } catch (e) {
                console.error("API Call Failed:", e);
                throw e;
            }
        };

        // --- COMPONENTS ---
        function StatCard({ label, value, sub, color }) {
            return React.createElement('div', { className: "bg-slate-900 border border-slate-800 p-6 rounded-xl flex flex-col items-center justify-center text-center" },
                React.createElement('span', { className: "text-sm font-semibold text-slate-500 uppercase mb-1" }, label),
                React.createElement('span', { className: clsx("text-4xl font-black mb-2", color) }, value),
                React.createElement('span', { className: "text-xs text-slate-600 font-mono bg-slate-950 px-2 py-1 rounded" }, sub)
            );
        }

        function FormTrajectoryCard({ homeForm, awayForm, homeTeamName, awayTeamName }) {
            if (!homeForm || !awayForm) return null;

            const getTrendIcon = (trend) => {
                if (trend === 'improving') return TrendingUp;
                if (trend === 'declining') return TrendingDown;
                return Minus;
            };

            const getTrendColor = (trend) => {
                if (trend === 'improving') return 'text-neon-400';
                if (trend === 'declining') return 'text-red-400';
                return 'text-slate-400';
            };

            const HomeIcon = getTrendIcon(homeForm.trend);
            const AwayIcon = getTrendIcon(awayForm.trend);

            // Calculate max value for scaling the graph
            const allGoals = [...homeForm.matchData, ...awayForm.matchData].map(m => m.goalsScored);
            const maxGoals = Math.max(...allGoals, 3);

            return React.createElement('div', { className: "bg-gradient-to-br from-slate-900 to-slate-950 border border-slate-800 rounded-xl p-6 space-y-6" },
                React.createElement('div', { className: "flex items-center gap-3" },
                    React.createElement('div', { className: "bg-slate-800 p-3 rounded-lg" },
                        React.createElement(LineChart, { className: "w-6 h-6 text-neon-400" })
                    ),
                    React.createElement('div', null,
                        React.createElement('h3', { className: "text-lg font-bold text-white" }, "Form Trajectory Analysis"),
                        React.createElement('p', { className: "text-xs text-slate-500" }, "Linear regression on last 6 matches")
                    )
                ),

                React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-6" },
                    // Home Team Form
                    React.createElement('div', { className: "space-y-4" },
                        React.createElement('div', { className: "flex items-center justify-between" },
                            React.createElement('span', { className: "text-sm font-bold text-white" }, homeTeamName || "Home"),
                            React.createElement('div', { className: clsx("flex items-center gap-2 px-3 py-1 rounded-lg text-sm font-bold", getTrendColor(homeForm.trend)) },
                                React.createElement(HomeIcon, { className: "w-4 h-4" }),
                                homeForm.trend.toUpperCase()
                            )
                        ),
                        React.createElement('div', { className: "grid grid-cols-3 gap-2 text-xs" },
                            React.createElement('div', { className: "bg-slate-950 p-2 rounded" },
                                React.createElement('div', { className: "text-slate-500" }, "Slope"),
                                React.createElement('div', { className: clsx("font-bold", homeForm.slope > 0 ? "text-neon-400" : homeForm.slope < 0 ? "text-red-400" : "text-slate-400") }, 
                                    homeForm.slope > 0 ? "+" : "", homeForm.slope
                                )
                            ),
                            React.createElement('div', { className: "bg-slate-950 p-2 rounded" },
                                React.createElement('div', { className: "text-slate-500" }, "Modifier"),
                                React.createElement('div', { className: "font-bold text-white" }, "×", homeForm.formModifier)
                            ),
                            React.createElement('div', { className: "bg-slate-950 p-2 rounded" },
                                React.createElement('div', { className: "text-slate-500" }, "Avg Goals"),
                                React.createElement('div', { className: "font-bold text-white" }, homeForm.avgGoalsScored)
                            )
                        ),
                        // Mini chart
                        homeForm.matchData.length > 0 && React.createElement('div', { className: "bg-slate-950 p-3 rounded-lg" },
                            React.createElement('svg', { width: "100%", height: "80", viewBox: "0 0 300 80" },
                                // Grid lines
                                React.createElement('line', { x1: 0, y1: 70, x2: 300, y2: 70, stroke: "#334155", strokeWidth: 1 }),
                                // Actual data points and line
                                ...homeForm.matchData.map((m, i) => {
                                    const x = 30 + (i * 45);
                                    const y = 70 - (m.goalsScored / maxGoals * 60);
                                    return [
                                        i > 0 && React.createElement('line', { 
                                            key: `line-${i}`,
                                            x1: 30 + ((i-1) * 45), 
                                            y1: 70 - (homeForm.matchData[i-1].goalsScored / maxGoals * 60),
                                            x2: x, 
                                            y2: y,
                                            stroke: "#4ade80", 
                                            strokeWidth: 2 
                                        }),
                                        React.createElement('circle', { 
                                            key: `point-${i}`,
                                            cx: x, 
                                            cy: y, 
                                            r: 4, 
                                            fill: "#4ade80" 
                                        }),
                                        React.createElement('text', { 
                                            key: `label-${i}`,
                                            x: x, 
                                            y: 78, 
                                            textAnchor: "middle", 
                                            fontSize: "10", 
                                            fill: "#64748b" 
                                        }, m.matchNumber)
                                    ];
                                }).flat(),
                                // Regression line
                                React.createElement('line', { 
                                    x1: 30, 
                                    y1: 70 - ((homeForm.slope * 1 + homeForm.intercept) / maxGoals * 60),
                                    x2: 30 + (4 * 45), 
                                    y2: 70 - ((homeForm.slope * 5 + homeForm.intercept) / maxGoals * 60),
                                    stroke: "#22c55e", 
                                    strokeWidth: 1,
                                    strokeDasharray: "4,4",
                                    opacity: 0.7
                                })
                            )
                        )
                    ),

                    // Away Team Form
                    React.createElement('div', { className: "space-y-4" },
                        React.createElement('div', { className: "flex items-center justify-between" },
                            React.createElement('span', { className: "text-sm font-bold text-white" }, awayTeamName || "Away"),
                            React.createElement('div', { className: clsx("flex items-center gap-2 px-3 py-1 rounded-lg text-sm font-bold", getTrendColor(awayForm.trend)) },
                                React.createElement(AwayIcon, { className: "w-4 h-4" }),
                                awayForm.trend.toUpperCase()
                            )
                        ),
                        React.createElement('div', { className: "grid grid-cols-3 gap-2 text-xs" },
                            React.createElement('div', { className: "bg-slate-950 p-2 rounded" },
                                React.createElement('div', { className: "text-slate-500" }, "Slope"),
                                React.createElement('div', { className: clsx("font-bold", awayForm.slope > 0 ? "text-neon-400" : awayForm.slope < 0 ? "text-red-400" : "text-slate-400") }, 
                                    awayForm.slope > 0 ? "+" : "", awayForm.slope
                                )
                            ),
                            React.createElement('div', { className: "bg-slate-950 p-2 rounded" },
                                React.createElement('div', { className: "text-slate-500" }, "Modifier"),
                                React.createElement('div', { className: "font-bold text-white" }, "×", awayForm.formModifier)
                            ),
                            React.createElement('div', { className: "bg-slate-950 p-2 rounded" },
                                React.createElement('div', { className: "text-slate-500" }, "Avg Goals"),
                                React.createElement('div', { className: "font-bold text-white" }, awayForm.avgGoalsScored)
                            )
                        ),
                        // Mini chart
                        awayForm.matchData.length > 0 && React.createElement('div', { className: "bg-slate-950 p-3 rounded-lg" },
                            React.createElement('svg', { width: "100%", height: "80", viewBox: "0 0 300 80" },
                                // Grid lines
                                React.createElement('line', { x1: 0, y1: 70, x2: 300, y2: 70, stroke: "#334155", strokeWidth: 1 }),
                                // Actual data points and line
                                ...awayForm.matchData.map((m, i) => {
                                    const x = 30 + (i * 45);
                                    const y = 70 - (m.goalsScored / maxGoals * 60);
                                    return [
                                        i > 0 && React.createElement('line', { 
                                            key: `line-${i}`,
                                            x1: 30 + ((i-1) * 45), 
                                            y1: 70 - (awayForm.matchData[i-1].goalsScored / maxGoals * 60),
                                            x2: x, 
                                            y2: y,
                                            stroke: "#ef4444", 
                                            strokeWidth: 2 
                                        }),
                                        React.createElement('circle', { 
                                            key: `point-${i}`,
                                            cx: x, 
                                            cy: y, 
                                            r: 4, 
                                            fill: "#ef4444" 
                                        }),
                                        React.createElement('text', { 
                                            key: `label-${i}`,
                                            x: x, 
                                            y: 78, 
                                            textAnchor: "middle", 
                                            fontSize: "10", 
                                            fill: "#64748b" 
                                        }, m.matchNumber)
                                    ];
                                }).flat(),
                                // Regression line
                                React.createElement('line', { 
                                    x1: 30, 
                                    y1: 70 - ((awayForm.slope * 1 + awayForm.intercept) / maxGoals * 60),
                                    x2: 30 + (4 * 45), 
                                    y2: 70 - ((awayForm.slope * 5 + awayForm.intercept) / maxGoals * 60),
                                    stroke: "#dc2626", 
                                    strokeWidth: 1,
                                    strokeDasharray: "4,4",
                                    opacity: 0.7
                                })
                            )
                        )
                    )
                ),

                React.createElement('div', { className: "bg-slate-900/50 border border-slate-700 rounded-lg p-3 text-xs text-slate-400" },
                    React.createElement('strong', { className: "text-slate-300" }, "Form Impact: "),
                    "Attack strength is multiplied by form modifier (0.85-1.15). ",
                    "Positive slope = improving form (boosted). Negative slope = declining form (penalized). ",
                    "Solid lines = actual goals. Dashed lines = regression trend."
                )
            );
        }

        function KellyCalculator({ prediction }) {
            const [bankroll, setBankroll] = useState(1000);
            const [selectedMarket, setSelectedMarket] = useState('home');
            const [bookieOdds, setBookieOdds] = useState(2.00);
            const [kellyFraction, setKellyFraction] = useState(0.25);

            // Get probability based on selected market
            const getModelProbability = () => {
                switch(selectedMarket) {
                    case 'home': return prediction.homeWinProb;
                    case 'draw': return prediction.drawProb;
                    case 'away': return prediction.awayWinProb;
                    case 'over': return prediction.trueGoalLine ? prediction.trueGoalLine.overProbability / 100 : 0;
                    case 'under': return prediction.trueGoalLine ? prediction.trueGoalLine.underProbability / 100 : 0;
                    case 'btts_yes': return prediction.btts ? prediction.btts.probBTTS_Yes / 100 : 0;
                    case 'btts_no': return prediction.btts ? prediction.btts.probBTTS_No / 100 : 0;
                    default: return 0;
                }
            };

            const modelProb = getModelProbability();
            const impliedProb = 1 / bookieOdds;
            
            // Kelly Criterion calculation
            const edge = modelProb - impliedProb;
            const expectedValue = (modelProb * bookieOdds) - 1;
            const expectedValuePercent = expectedValue * 100;
            
            // Full Kelly: (bp - q) / b where b = odds - 1, p = win prob, q = lose prob
            const b = bookieOdds - 1;
            const q = 1 - modelProb;
            const fullKelly = edge > 0 ? ((b * modelProb - q) / b) : 0;
            
            // Fractional Kelly (more conservative)
            const fractionalKelly = fullKelly * kellyFraction;
            
            // Stake amounts
            const fullKellyStake = bankroll * fullKelly;
            const fractionalKellyStake = bankroll * fractionalKelly;
            
            // Potential profit
            const potentialProfit = fractionalKellyStake * (bookieOdds - 1);
            
            // Risk of ruin approximation
            const hasEdge = edge > 0;
            const riskLevel = fullKelly > 0.10 ? "High" : fullKelly > 0.05 ? "Medium" : fullKelly > 0.02 ? "Low" : "Very Low";

            return React.createElement('div', { className: "bg-gradient-to-br from-slate-900 to-slate-950 border border-slate-800 rounded-xl p-6 space-y-6" },
                React.createElement('div', { className: "flex items-center justify-between" },
                    React.createElement('div', { className: "flex items-center gap-3" },
                        React.createElement('div', { className: "bg-slate-800 p-3 rounded-lg" },
                            React.createElement(DollarSign, { className: "w-6 h-6 text-neon-400" })
                        ),
                        React.createElement('div', null,
                            React.createElement('h3', { className: "text-lg font-bold text-white" }, "Kelly Criterion Calculator"),
                            React.createElement('p', { className: "text-xs text-slate-500" }, "Optimal bet sizing for bankroll growth")
                        )
                    ),
                    hasEdge 
                        ? React.createElement('div', { className: "px-4 py-2 rounded-lg border bg-neon-500/20 text-neon-400 border-neon-500/50 font-bold text-sm" }, "POSITIVE EDGE")
                        : React.createElement('div', { className: "px-4 py-2 rounded-lg border bg-red-500/20 text-red-400 border-red-500/50 font-bold text-sm" }, "NEGATIVE EDGE")
                ),

                React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-4 gap-4" },
                    React.createElement('div', { className: "space-y-2" },
                        React.createElement('label', { className: "text-xs font-semibold text-slate-500 uppercase" }, "Bankroll (₦)"),
                        React.createElement('input', { 
                            type: "number", 
                            step: "100",
                            className: "w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-neon-500", 
                            value: bankroll, 
                            onChange: (e) => setBankroll(parseFloat(e.target.value) || 0) 
                        })
                    ),
                    React.createElement('div', { className: "space-y-2" },
                        React.createElement('label', { className: "text-xs font-semibold text-slate-500 uppercase" }, "Market"),
                        React.createElement('select', { 
                            className: "w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-neon-500", 
                            value: selectedMarket, 
                            onChange: (e) => setSelectedMarket(e.target.value) 
                        },
                            React.createElement('option', { value: "home" }, "Home Win"),
                            React.createElement('option', { value: "draw" }, "Draw"),
                            React.createElement('option', { value: "away" }, "Away Win"),
                            prediction.trueGoalLine && React.createElement('option', { value: "over" }, "Over"),
                            prediction.trueGoalLine && React.createElement('option', { value: "under" }, "Under"),
                            prediction.btts && React.createElement('option', { value: "btts_yes" }, "BTTS Yes"),
                            prediction.btts && React.createElement('option', { value: "btts_no" }, "BTTS No")
                        )
                    ),
                    React.createElement('div', { className: "space-y-2" },
                        React.createElement('label', { className: "text-xs font-semibold text-slate-500 uppercase" }, "Bookie Odds"),
                        React.createElement('input', { 
                            type: "number", 
                            step: "0.1",
                            className: "w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-neon-500", 
                            value: bookieOdds, 
                            onChange: (e) => setBookieOdds(parseFloat(e.target.value) || 1.01) 
                        })
                    ),
                    React.createElement('div', { className: "space-y-2" },
                        React.createElement('label', { className: "text-xs font-semibold text-slate-500 uppercase" }, "Kelly Fraction"),
                        React.createElement('input', { 
                            type: "number", 
                            step: "0.05",
                            min: "0.1",
                            max: "1",
                            className: "w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-neon-500", 
                            value: kellyFraction, 
                            onChange: (e) => setKellyFraction(parseFloat(e.target.value) || 0.25) 
                        })
                    )
                ),

                React.createElement('div', { className: "grid grid-cols-2 md:grid-cols-5 gap-4" },
                    React.createElement('div', { className: "bg-slate-950 p-4 rounded-lg border border-slate-800" },
                        React.createElement('div', { className: "text-xs text-slate-500 mb-1" }, "Model Probability"),
                        React.createElement('div', { className: "text-2xl font-bold text-white" }, (modelProb * 100).toFixed(2), "%")
                    ),
                    React.createElement('div', { className: "bg-slate-950 p-4 rounded-lg border border-slate-800" },
                        React.createElement('div', { className: "text-xs text-slate-500 mb-1" }, "Implied Probability"),
                        React.createElement('div', { className: "text-2xl font-bold text-slate-400" }, (impliedProb * 100).toFixed(2), "%")
                    ),
                    React.createElement('div', { className: "bg-slate-950 p-4 rounded-lg border border-slate-800" },
                        React.createElement('div', { className: "text-xs text-slate-500 mb-1" }, "Edge"),
                        React.createElement('div', { className: clsx("text-2xl font-bold", edge > 0 ? "text-neon-400" : "text-red-400") }, 
                            edge > 0 ? "+" : "", (edge * 100).toFixed(2), "%"
                        )
                    ),
                    React.createElement('div', { className: "bg-slate-950 p-4 rounded-lg border border-slate-800" },
                        React.createElement('div', { className: "text-xs text-slate-500 mb-1" }, "Expected Value"),
                        React.createElement('div', { className: clsx("text-2xl font-bold", expectedValue > 0 ? "text-neon-400" : "text-red-400") }, 
                            expectedValue > 0 ? "+" : "", expectedValuePercent.toFixed(2), "%"
                        )
                    ),
                    React.createElement('div', { className: "bg-slate-950 p-4 rounded-lg border border-slate-800" },
                        React.createElement('div', { className: "text-xs text-slate-500 mb-1" }, "Risk Level"),
                        React.createElement('div', { className: "text-lg font-bold text-white" }, riskLevel)
                    )
                ),

                React.createElement('div', { className: "bg-slate-950 border border-slate-800 rounded-lg p-6" },
                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-6" },
                        React.createElement('div', null,
                            React.createElement('div', { className: "text-sm font-semibold text-slate-400 uppercase mb-3" }, "Full Kelly (100%)"),
                            React.createElement('div', { className: "space-y-3" },
                                React.createElement('div', { className: "flex justify-between items-center" },
                                    React.createElement('span', { className: "text-slate-500" }, "Percentage:"),
                                    React.createElement('span', { className: "text-xl font-bold text-white" }, (fullKelly * 100).toFixed(2), "%")
                                ),
                                React.createElement('div', { className: "flex justify-between items-center" },
                                    React.createElement('span', { className: "text-slate-500" }, "Stake Amount:"),
                                    React.createElement('span', { className: "text-2xl font-bold text-yellow-400" }, "₦", fullKellyStake.toFixed(2))
                                ),
                                React.createElement('div', { className: "text-xs text-slate-600 bg-slate-900 p-2 rounded" },
                                    "⚠️ Aggressive - Maximum growth but higher volatility"
                                )
                            )
                        ),
                        React.createElement('div', null,
                            React.createElement('div', { className: "text-sm font-semibold text-slate-400 uppercase mb-3" }, 
                                "Fractional Kelly (", (kellyFraction * 100).toFixed(0), "%)"
                            ),
                            React.createElement('div', { className: "space-y-3" },
                                React.createElement('div', { className: "flex justify-between items-center" },
                                    React.createElement('span', { className: "text-slate-500" }, "Percentage:"),
                                    React.createElement('span', { className: "text-xl font-bold text-white" }, (fractionalKelly * 100).toFixed(2), "%")
                                ),
                                React.createElement('div', { className: "flex justify-between items-center" },
                                    React.createElement('span', { className: "text-slate-500" }, "Stake Amount:"),
                                    React.createElement('span', { className: "text-2xl font-bold text-neon-400" }, "₦", fractionalKellyStake.toFixed(2))
                                ),
                                React.createElement('div', { className: "flex justify-between items-center" },
                                    React.createElement('span', { className: "text-slate-500" }, "Potential Profit:"),
                                    React.createElement('span', { className: "text-lg font-bold text-neon-400" }, "₦", potentialProfit.toFixed(2))
                                ),
                                React.createElement('div', { className: "text-xs text-neon-400 bg-neon-500/10 p-2 rounded" },
                                    "✓ Recommended - Reduces variance and drawdown risk"
                                )
                            )
                        )
                    )
                ),

                React.createElement('div', { className: "bg-slate-900/50 border border-slate-700 rounded-lg p-4 space-y-2" },
                    React.createElement('div', { className: "text-xs font-semibold text-slate-400 uppercase mb-2" }, "Kelly Criterion Formula"),
                    React.createElement('div', { className: "text-sm text-slate-300 font-mono" }, "f* = (bp - q) / b"),
                    React.createElement('div', { className: "text-xs text-slate-500 space-y-1" },
                        React.createElement('div', null, "• b = decimal odds - 1 = ", b.toFixed(2)),
                        React.createElement('div', null, "• p = model probability = ", modelProb.toFixed(4)),
                        React.createElement('div', null, "• q = 1 - p = ", q.toFixed(4)),
                        React.createElement('div', { className: "pt-2 border-t border-slate-700 mt-2" },
                            React.createElement('strong', null, "Note: "), 
                            "Only bet when Edge > 0. Fractional Kelly (25-50%) is recommended to reduce risk of ruin. All amounts in Naira (₦)."
                        )
                    )
                ) : activeTab === 'history' ? React.createElement('div', { className: "space-y-6" },
                    React.createElement('div', { className: "bg-slate-900 border border-slate-800 p-6 rounded-xl space-y-4" },
                        React.createElement('h3', { className: "text-xl font-bold text-white mb-4" }, "Manage Match History"),
                        React.createElement('div', { className: "space-y-2" },
                            React.createElement('label', { className: "text-xs font-semibold text-slate-500 uppercase" }, "Select Team"),
                            React.createElement('select', { className: "w-full bg-slate-950 border border-slate-700 p-3 rounded text-white", value: selectedTeamForHistory, onChange: (e) => setSelectedTeamForHistory(e.target.value) },
                                React.createElement('option', { value: "" }, "Select a team..."),
                                leaguesList.map(league => 
                                    React.createElement('optgroup', { key: league.id, label: league.name },
                                        teamsList.filter(t => t.league_id === league.id).map(t =>
                                            React.createElement('option', { key: t.id, value: t.id }, t.name)
                                        )
                                    )
                                )
                            )
                        ),
                        React.createElement('div', { className: "text-xs text-slate-500 bg-slate-950 p-3 rounded" },
                            "Enter the last 5 matches for the selected team (from oldest to most recent). Points are calculated automatically based on goals."
                        )
                    ),

                    selectedTeamForHistory && React.createElement('div', { className: "bg-slate-900 border border-slate-800 rounded-xl overflow-hidden" },
                        React.createElement('div', { className: "p-4 bg-slate-950 border-b border-slate-800 flex items-center justify-between" },
                            React.createElement('h4', { className: "text-lg font-bold text-white" }, "Last 5 Matches"),
                            React.createElement('button', { onClick: saveMatchHistory, className: "bg-neon-500 text-black font-bold px-4 py-2 rounded flex items-center gap-2" },
                                React.createElement(Save, { className: "w-4 h-4" }), "Save History"
                            )
                        ),
                        React.createElement('table', { className: "w-full text-left" },
                            React.createElement('thead', { className: "bg-slate-950 text-slate-500 text-xs uppercase" }, React.createElement('tr', null,
                                React.createElement('th', { className: "p-4" }, "Match #"),
                                React.createElement('th', { className: "p-4" }, "Goals Scored"),
                                React.createElement('th', { className: "p-4" }, "Goals Conceded"),
                                React.createElement('th', { className: "p-4" }, "Location"),
                                React.createElement('th', { className: "p-4" }, "Points"),
                                React.createElement('th', { className: "p-4" }, "Result")
                            )),
                            React.createElement('tbody', { className: "divide-y divide-slate-800" }, matchHistory.map((match, idx) => 
                                React.createElement('tr', { key: idx },
                                    React.createElement('td', { className: "p-4 font-bold text-white" }, match.match_number),
                                    React.createElement('td', { className: "p-4" }, React.createElement('input', { type: "number", min: 0, max: 10, className: "w-16 bg-slate-950 border border-slate-700 p-2 rounded text-white", value: match.goals_scored, onChange: (e) => updateMatchHistory(idx, 'goals_scored', e.target.value) })),
                                    React.createElement('td', { className: "p-4" }, React.createElement('input', { type: "number", min: 0, max: 10, className: "w-16 bg-slate-950 border border-slate-700 p-2 rounded text-white", value: match.goals_conceded, onChange: (e) => updateMatchHistory(idx, 'goals_conceded', e.target.value) })),
                                    React.createElement('td', { className: "p-4" }, React.createElement('select', { className: "bg-slate-950 border border-slate-700 p-2 rounded text-white", value: match.was_home, onChange: (e) => updateMatchHistory(idx, 'was_home', e.target.value) },
                                        React.createElement('option', { value: 1 }, "Home"),
                                        React.createElement('option', { value: 0 }, "Away")
                                    )),
                                    React.createElement('td', { className: "p-4" }, React.createElement('span', { className: clsx("px-3 py-1 rounded text-sm font-bold", match.points === 3 ? "bg-neon-500/20 text-neon-400" : match.points === 1 ? "bg-yellow-500/20 text-yellow-400" : "bg-red-500/20 text-red-400") }, match.points)),
                                    React.createElement('td', { className: "p-4 text-slate-400 font-mono" }, `${match.goals_scored}-${match.goals_conceded}`)
                                )
                            ))
                        )
                    )
                ) : null
            );
        }

        function BTTSCard({ btts }) {
            const getRecommendationColor = (rec) => {
                if (rec.includes('YES')) return 'text-neon-400';
                if (rec.includes('NO') && rec !== 'NO BET') return 'text-orange-400';
                return 'text-slate-400';
            };

            const getValueBadgeColor = (rating) => {
                if (rating.includes('STRONG')) return 'bg-neon-500/20 text-neon-400 border-neon-500/50';
                if (rating.includes('GOOD')) return 'bg-yellow-500/20 text-yellow-400 border-yellow-500/50';
                if (rating.includes('SLIGHT')) return 'bg-blue-500/20 text-blue-400 border-blue-500/50';
                if (rating.includes('UNDERPRICING')) return 'bg-orange-500/20 text-orange-400 border-orange-500/50';
                return 'bg-slate-700/50 text-slate-400 border-slate-600';
            };

            return React.createElement('div', { className: "bg-gradient-to-br from-slate-900 to-slate-950 border border-slate-800 rounded-xl p-6 space-y-6" },
                React.createElement('div', { className: "flex items-center justify-between" },
                    React.createElement('div', { className: "flex items-center gap-3" },
                        React.createElement('div', { className: "bg-slate-800 p-3 rounded-lg" },
                            React.createElement(Users, { className: "w-6 h-6 text-neon-400" })
                        ),
                        React.createElement('div', null,
                            React.createElement('h3', { className: "text-lg font-bold text-white" }, "Both Teams To Score (BTTS)"),
                            React.createElement('p', { className: "text-xs text-slate-500" }, "Goal/Goal value analysis")
                        )
                    ),
                    React.createElement('div', { className: clsx("px-4 py-2 rounded-lg border font-bold text-sm", getValueBadgeColor(btts.valueRating)) },
                        btts.valueRating
                    )
                ),

                React.createElement('div', { className: "grid grid-cols-2 md:grid-cols-4 gap-4" },
                    React.createElement('div', { className: "bg-slate-950 p-4 rounded-lg border border-slate-800" },
                        React.createElement('div', { className: "text-xs text-slate-500 mb-1" }, "BTTS Yes"),
                        React.createElement('div', { className: "text-2xl font-bold text-neon-400" }, btts.probBTTS_Yes, "%"),
                        React.createElement('div', { className: "text-[10px] text-slate-600 mt-1" }, btts.modelType)
                    ),
                    React.createElement('div', { className: "bg-slate-950 p-4 rounded-lg border border-slate-800" },
                        React.createElement('div', { className: "text-xs text-slate-500 mb-1" }, "BTTS No"),
                        React.createElement('div', { className: "text-2xl font-bold text-red-400" }, btts.probBTTS_No, "%"),
                        React.createElement('div', { className: "text-[10px] text-slate-600 mt-1" }, "λ₃ = ", btts.lambda3)
                    ),
                    React.createElement('div', { className: "bg-slate-950 p-4 rounded-lg border border-slate-800" },
                        React.createElement('div', { className: "text-xs text-slate-500 mb-1" }, "Home 0 Goals"),
                        React.createElement('div', { className: "text-2xl font-bold text-slate-400" }, btts.probHomeZero, "%")
                    ),
                    React.createElement('div', { className: "bg-slate-950 p-4 rounded-lg border border-slate-800" },
                        React.createElement('div', { className: "text-xs text-slate-500 mb-1" }, "Away 0 Goals"),
                        React.createElement('div', { className: "text-2xl font-bold text-slate-400" }, btts.probAwayZero, "%")
                    )
                ),

                btts.probBTTS_Yes_Independent && React.createElement('div', { className: "bg-slate-900/50 border border-slate-700 rounded-lg p-4" },
                    React.createElement('div', { className: "text-xs font-semibold text-slate-400 mb-2 uppercase" }, "Model Comparison"),
                    React.createElement('div', { className: "grid grid-cols-2 gap-4 text-sm" },
                        React.createElement('div', null,
                            React.createElement('span', { className: "text-slate-500" }, "Bivariate: "),
                            React.createElement('span', { className: "text-white font-bold" }, btts.probBTTS_Yes, "%")
                        ),
                        React.createElement('div', null,
                            React.createElement('span', { className: "text-slate-500" }, "Independent: "),
                            React.createElement('span', { className: "text-slate-400 font-bold" }, btts.probBTTS_Yes_Independent, "%")
                        )
                    ),
                    React.createElement('div', { className: "text-xs text-slate-500 mt-2" },
                        "Difference: ", 
                        React.createElement('span', { className: clsx("font-bold", (btts.probBTTS_Yes - btts.probBTTS_Yes_Independent) > 0 ? "text-neon-400" : "text-red-400") },
                            ((btts.probBTTS_Yes - btts.probBTTS_Yes_Independent) > 0 ? "+" : ""),
                            (btts.probBTTS_Yes - btts.probBTTS_Yes_Independent).toFixed(2), "%"
                        ),
                        " (Bivariate accounts for goal dependency)"
                    )
                ),

                React.createElement('div', { className: "bg-slate-950 border border-slate-800 rounded-lg p-6" },
                    React.createElement('div', { className: "flex items-center justify-between mb-4" },
                        React.createElement('span', { className: "text-sm font-semibold text-slate-400 uppercase" }, "Recommendation"),
                        React.createElement('div', { className: clsx("px-4 py-2 rounded-lg font-bold text-lg", getRecommendationColor(btts.recommendation)) },
                            btts.recommendation
                        )
                    ),
                    React.createElement('div', { className: "grid grid-cols-2 md:grid-cols-4 gap-4 mt-4" },
                        React.createElement('div', { className: "bg-slate-900 p-4 rounded-lg" },
                            React.createElement('div', { className: "text-xs text-slate-500 mb-2" }, "Fair BTTS Yes Odds"),
                            React.createElement('div', { className: "text-xl font-bold text-white" }, btts.fairOddsBTTS_Yes)
                        ),
                        React.createElement('div', { className: "bg-slate-900 p-4 rounded-lg" },
                            React.createElement('div', { className: "text-xs text-slate-500 mb-2" }, "Bookie BTTS Yes Odds"),
                            React.createElement('div', { className: "text-xl font-bold text-yellow-400" }, btts.bookieOddsYes)
                        ),
                        React.createElement('div', { className: "bg-slate-900 p-4 rounded-lg" },
                            React.createElement('div', { className: "text-xs text-slate-500 mb-2" }, "Value Difference"),
                            React.createElement('div', { className: clsx("text-xl font-bold", btts.expectedValue > 0 ? "text-neon-400" : "text-red-400") }, 
                                btts.expectedValue > 0 ? '+' : '', btts.expectedValue
                            )
                        ),
                        React.createElement('div', { className: "bg-slate-900 p-4 rounded-lg" },
                            React.createElement('div', { className: "text-xs text-slate-500 mb-2" }, "Confidence"),
                            React.createElement('div', { className: "text-xl font-bold text-white" }, btts.confidence)
                        )
                    ),
                    React.createElement('div', { className: "mt-4 p-3 bg-slate-900/50 rounded text-xs text-slate-400" },
                        React.createElement('strong', { className: "text-slate-300" }, "How to read: "),
                        "Positive value difference = Bookie odds higher than fair (VALUE on YES). ",
                        "Large negative value = Bookie significantly underpricing YES odds (consider BTTS NO if available)."
                    )
                )
            );
        }

        function TGLCard({ tgl }) {
            const getRecommendationColor = (rec) => {
                if (rec === 'OVER') return 'text-neon-400';
                if (rec === 'UNDER') return 'text-red-400';
                return 'text-slate-400';
            };

            const getRecommendationIcon = (rec) => {
                if (rec === 'OVER') return TrendingUp;
                if (rec === 'UNDER') return TrendingDown;
                return Minus;
            };

            const getValueBadgeColor = (rating) => {
                if (rating.includes('STRONG')) return 'bg-neon-500/20 text-neon-400 border-neon-500/50';
                if (rating.includes('GOOD')) return 'bg-yellow-500/20 text-yellow-400 border-yellow-500/50';
                if (rating.includes('SLIGHT')) return 'bg-blue-500/20 text-blue-400 border-blue-500/50';
                return 'bg-slate-700/50 text-slate-400 border-slate-600';
            };

            const Icon = getRecommendationIcon(tgl.recommendation);

            return React.createElement('div', { className: "bg-gradient-to-br from-slate-900 to-slate-950 border border-slate-800 rounded-xl p-6 space-y-6" },
                React.createElement('div', { className: "flex items-center justify-between" },
                    React.createElement('div', { className: "flex items-center gap-3" },
                        React.createElement('div', { className: "bg-slate-800 p-3 rounded-lg" },
                            React.createElement(Target, { className: "w-6 h-6 text-neon-400" })
                        ),
                        React.createElement('div', null,
                            React.createElement('h3', { className: "text-lg font-bold text-white" }, "True Goal Line Analysis"),
                            React.createElement('p', { className: "text-xs text-slate-500" }, "Compare expected goals vs bookmaker line")
                        )
                    ),
                    React.createElement('div', { className: clsx("px-4 py-2 rounded-lg border font-bold text-sm", getValueBadgeColor(tgl.valueRating)) },
                        tgl.valueRating
                    )
                ),

                React.createElement('div', { className: "grid grid-cols-2 md:grid-cols-4 gap-4" },
                    React.createElement('div', { className: "bg-slate-950 p-4 rounded-lg border border-slate-800" },
                        React.createElement('div', { className: "text-xs text-slate-500 mb-1" }, "Total xG"),
                        React.createElement('div', { className: "text-2xl font-bold text-white" }, tgl.totalExpectedGoals)
                    ),
                    React.createElement('div', { className: "bg-slate-950 p-4 rounded-lg border border-slate-800" },
                        React.createElement('div', { className: "text-xs text-slate-500 mb-1" }, "Bookie Line"),
                        React.createElement('div', { className: "text-2xl font-bold text-slate-400" }, tgl.bookieLine)
                    ),
                    React.createElement('div', { className: "bg-slate-950 p-4 rounded-lg border border-slate-800" },
                        React.createElement('div', { className: "text-xs text-slate-500 mb-1" }, "Difference"),
                        React.createElement('div', { className: clsx("text-2xl font-bold", tgl.difference > 0 ? 'text-neon-400' : 'text-red-400') }, 
                            tgl.difference > 0 ? '+' : '', tgl.difference
                        )
                    ),
                    React.createElement('div', { className: "bg-slate-950 p-4 rounded-lg border border-slate-800" },
                        React.createElement('div', { className: "text-xs text-slate-500 mb-1" }, "Confidence"),
                        React.createElement('div', { className: "text-2xl font-bold text-white" }, tgl.confidence)
                    )
                ),

                React.createElement('div', { className: "bg-slate-950 border border-slate-800 rounded-lg p-6" },
                    React.createElement('div', { className: "flex items-center justify-between mb-4" },
                        React.createElement('span', { className: "text-sm font-semibold text-slate-400 uppercase" }, "Recommendation"),
                        React.createElement('div', { className: clsx("flex items-center gap-2 px-4 py-2 rounded-lg font-bold text-xl", 
                            tgl.recommendation === 'OVER' ? 'bg-neon-500/20 text-neon-400' : 
                            tgl.recommendation === 'UNDER' ? 'bg-red-500/20 text-red-400' : 
                            'bg-slate-800 text-slate-400'
                        ) },
                            React.createElement(Icon, { className: "w-5 h-5" }),
                            tgl.recommendation
                        )
                    ),
                    React.createElement('div', { className: "grid grid-cols-2 gap-4 mt-4" },
                        React.createElement('div', { className: "bg-slate-900 p-4 rounded-lg" },
                            React.createElement('div', { className: "text-xs text-slate-500 mb-2" }, "Over Probability"),
                            React.createElement('div', { className: "text-xl font-bold text-neon-400" }, tgl.overProbability, "%"),
                            React.createElement('div', { className: "text-xs text-slate-600 mt-1" }, "Fair Odds: ", tgl.impliedOverOdds)
                        ),
                        React.createElement('div', { className: "bg-slate-900 p-4 rounded-lg" },
                            React.createElement('div', { className: "text-xs text-slate-500 mb-2" }, "Under Probability"),
                            React.createElement('div', { className: "text-xl font-bold text-red-400" }, tgl.underProbability, "%"),
                            React.createElement('div', { className: "text-xs text-slate-600 mt-1" }, "Fair Odds: ", tgl.impliedUnderOdds)
                        )
                    )
                )
            );
        }

        function HomePage() {
            const [leaguesList, setLeaguesList] = useState([]);
            const [teamsList, setTeamsList] = useState([]);
            const [selectedLeague, setSelectedLeague] = useState("");
            const [selectedHome, setSelectedHome] = useState("");
            const [selectedAway, setSelectedAway] = useState("");
            const [goalLine, setGoalLine] = useState(2.5);
            const [bttsOdds, setBttsOdds] = useState(1.80);
            const [loading, setLoading] = useState(false);
            const [prediction, setPrediction] = useState(null);
            const [error, setError] = useState(null);

            useEffect(() => {
                setLoading(true);
                api('health')
                    .then(() => api('getLeagues'))
                    .then(setLeaguesList)
                    .catch(err => {
                        console.error("Startup Error:", err);
                        setError(err.message);
                    })
                    .finally(() => setLoading(false));
            }, []);

            useEffect(() => {
                if (selectedLeague) {
                    setLoading(true);
                    api('getTeams', { leagueId: parseInt(selectedLeague) })
                        .then(setTeamsList)
                        .catch(setError)
                        .finally(() => setLoading(false));
                    setSelectedHome("");
                    setSelectedAway("");
                    setPrediction(null);
                }
            }, [selectedLeague]);

            const handleCalculate = async () => {
                if (!selectedLeague || !selectedHome || !selectedAway) return;
                if (selectedHome === selectedAway) { alert("Home and Away teams cannot be the same."); return; }

                setLoading(true);
                setError(null);
                try {
                    const result = await api('predict', {
                        leagueId: parseInt(selectedLeague),
                        homeTeamId: parseInt(selectedHome),
                        awayTeamId: parseInt(selectedAway),
                        goalLine: parseFloat(goalLine),
                        bttsOdds: parseFloat(bttsOdds)
                    });
                    setPrediction(result);
                } catch (e) {
                    setError("Failed to calculate prediction.");
                } finally {
                    setLoading(false);
                }
            };

            const maxProb = prediction ? Math.max(...prediction.matrix.flat().map(c => c.prob)) : 0;

            if (error) {
                return React.createElement('div', { className: "flex flex-col items-center justify-center min-h-[50vh] space-y-6 text-center px-4" },
                    React.createElement('div', { className: "bg-red-500/10 p-4 rounded-full" }, React.createElement(AlertTriangle, { className: "w-12 h-12 text-red-500" })),
                    React.createElement('h2', { className: "text-2xl font-bold text-white" }, "Connection Error"),
                    React.createElement('p', { className: "text-red-300 max-w-md font-mono text-sm bg-black/50 p-3 rounded border border-red-500/30" }, error),
                    React.createElement('button', { onClick: () => window.location.reload(), className: "bg-slate-800 hover:bg-slate-700 text-white px-6 py-2 rounded transition-colors" }, "Retry Connection"),
                    React.createElement('div', { className: "text-xs text-slate-500 bg-slate-900 p-4 rounded text-left font-mono mt-4" }, 
                        "Troubleshooting: 1. Check Netlify Logs. 2. Ensure DATABASE_URL is correct. 3. Check if DB is sleeping."
                    )
                );
            }

            return React.createElement('div', { className: "space-y-12 py-10" },
                React.createElement('div', { className: "text-center space-y-4" },
                    React.createElement('h1', { className: "text-4xl md:text-6xl font-black text-white tracking-tighter" }, "MATCH ", React.createElement('span', { className: "text-neon-400" }, "PREDICTOR")),
                    React.createElement('p', { className: "text-slate-400 max-w-lg mx-auto" }, "Advanced football prediction using Dixon-Coles model and True Goal Line analysis.")
                ),
                React.createElement('div', { className: "grid md:grid-cols-6 gap-4 p-6 bg-slate-900/50 border border-slate-800 rounded-2xl shadow-2xl" },
                    React.createElement('div', { className: "space-y-2" },
                        React.createElement('label', { className: "text-xs font-semibold text-slate-500 uppercase" }, "League"),
                        React.createElement('select', { className: "w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-neon-500", value: selectedLeague, onChange: (e) => setSelectedLeague(e.target.value) },
                            React.createElement('option', { value: "" }, "Select League..."),
                            leaguesList.map(l => React.createElement('option', { key: l.id, value: l.id }, l.name))
                        )
                    ),
                    React.createElement('div', { className: "space-y-2" },
                        React.createElement('label', { className: "text-xs font-semibold text-slate-500 uppercase" }, "Home Team"),
                        React.createElement('select', { className: "w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-neon-500 disabled:opacity-50", value: selectedHome, onChange: (e) => setSelectedHome(e.target.value), disabled: !selectedLeague || loading },
                            React.createElement('option', { value: "" }, "Select Team..."),
                            teamsList.map(t => React.createElement('option', { key: t.id, value: t.id }, t.name))
                        )
                    ),
                    React.createElement('div', { className: "space-y-2" },
                        React.createElement('label', { className: "text-xs font-semibold text-slate-500 uppercase" }, "Away Team"),
                        React.createElement('select', { className: "w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-neon-500 disabled:opacity-50", value: selectedAway, onChange: (e) => setSelectedAway(e.target.value), disabled: !selectedLeague || loading },
                            React.createElement('option', { value: "" }, "Select Team..."),
                            teamsList.map(t => React.createElement('option', { key: t.id, value: t.id }, t.name))
                        )
                    ),
                    React.createElement('div', { className: "space-y-2" },
                        React.createElement('label', { className: "text-xs font-semibold text-slate-500 uppercase" }, "Goal Line"),
                        React.createElement('input', { type: "number", step: "0.5", className: "w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-neon-500", value: goalLine, onChange: (e) => setGoalLine(e.target.value) })
                    ),
                    React.createElement('div', { className: "space-y-2" },
                        React.createElement('label', { className: "text-xs font-semibold text-slate-500 uppercase" }, "BTTS Odds"),
                        React.createElement('input', { type: "number", step: "0.1", className: "w-full bg-slate-950 border border-slate-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-neon-500", value: bttsOdds, onChange: (e) => setBttsOdds(e.target.value) })
                    ),
                    React.createElement('div', { className: "flex items-end" },
                        React.createElement('button', { onClick: handleCalculate, disabled: loading || !selectedHome || !selectedAway, className: "w-full bg-neon-500 hover:bg-neon-400 text-slate-950 font-bold py-3 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2" },
                            loading ? React.createElement(Loader2, { className: "animate-spin w-5 h-5" }) : React.createElement(Calculator, { className: "w-5 h-5" }), "CALCULATE"
                        )
                    )
                ),
                prediction && React.createElement('div', { className: "animate-in fade-in slide-in-from-bottom-8 duration-500 space-y-8" },
                    React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-6" },
                        React.createElement(StatCard, { label: "Home Win", value: (prediction.homeWinProb * 100).toFixed(1) + "%", sub: `xG: ${prediction.homeExpGoals.toFixed(2)}`, color: "text-neon-400" }),
                        React.createElement(StatCard, { label: "Draw", value: (prediction.drawProb * 100).toFixed(1) + "%", sub: "Neutral Outcome", color: "text-slate-200" }),
                        React.createElement(StatCard, { label: "Away Win", value: (prediction.awayWinProb * 100).toFixed(1) + "%", sub: `xG: ${prediction.awayExpGoals.toFixed(2)}`, color: "text-red-400" })
                    ),

                    (prediction.homeForm || prediction.awayForm) && React.createElement(FormTrajectoryCard, { 
                        homeForm: prediction.homeForm, 
                        awayForm: prediction.awayForm,
                        homeTeamName: teamsList.find(t => t.id === parseInt(selectedHome))?.name,
                        awayTeamName: teamsList.find(t => t.id === parseInt(selectedAway))?.name
                    }),
                    
                    prediction.trueGoalLine && React.createElement(TGLCard, { tgl: prediction.trueGoalLine }),

                    prediction.btts && React.createElement(BTTSCard, { btts: prediction.btts }),

                    React.createElement(KellyCalculator, { prediction: prediction }),

                    React.createElement('div', { className: "overflow-x-auto" },
                        React.createElement('div', { className: "min-w-[600px] bg-slate-900 border border-slate-800 rounded-xl p-6" },
                            React.createElement('h3', { className: "text-lg font-bold text-white mb-4" }, "Dixon-Coles Probability Matrix (%)"),
                            React.createElement('div', { className: "grid grid-cols-[auto_repeat(6,1fr)] gap-1" },
                                React.createElement('div', { className: "flex items-center justify-center font-bold text-slate-500 text-xs p-2" }, "H \\ A"),
                                [0,1,2,3,4,5].map(g => React.createElement('div', { key: `head-${g}`, className: "flex items-center justify-center font-bold text-slate-400 bg-slate-950/50 p-2 rounded" }, g)),
                                prediction.matrix.map((row, hIdx) => React.createElement(React.Fragment, { key: `row-${hIdx}` },
                                    React.createElement('div', { className: "flex items-center justify-center font-bold text-slate-400 bg-slate-950/50 p-2 rounded" }, hIdx),
                                    row.map((cell, aIdx) => React.createElement('div', { key: `${hIdx}-${aIdx}`, className: clsx("flex flex-col items-center justify-center p-3 rounded transition-all", cell.prob === maxProb ? "bg-neon-500 text-slate-950 font-bold scale-105 z-10" : "bg-slate-950 hover:bg-slate-800 text-slate-300") },
                                        React.createElement('span', { className: "text-sm" }, (cell.prob * 100).toFixed(1) + "%")
                                    ))
                                ))
                            )
                        )
                    )
                )
            );
        }

        function AdminPage() {
            const [pin, setPin] = useState("");
            const [authorized, setAuthorized] = useState(false);
            const [activeTab, setActiveTab] = useState('leagues');
            const [leaguesList, setLeaguesList] = useState([]);
            const [teamsList, setTeamsList] = useState([]);
            
            const [editingLeagueId, setEditingLeagueId] = useState(null);
            const [leagueForm, setLeagueForm] = useState({ name: '', avgHome: 1.5, avgAway: 1.2 });
            const [editingTeamId, setEditingTeamId] = useState(null);
            const [teamForm, setTeamForm] = useState({ league_id: '', name: '', home_goals_for: 0, home_goals_against: 0, home_games_played: 0, away_goals_for: 0, away_goals_against: 0, away_games_played: 0 });

            // Match History state
            const [selectedTeamForHistory, setSelectedTeamForHistory] = useState('');
            const [matchHistory, setMatchHistory] = useState(Array(5).fill().map((_, i) => ({
                match_number: i + 1,
                goals_scored: 0,
                goals_conceded: 0,
                was_home: 1,
                points: 0
            })));

            async function verifyPin(p) {
                return p === '1234'; 
            }

            const handleAuth = async () => {
                if (await verifyPin(pin)) {
                    setAuthorized(true);
                    refreshData();
                } else {
                    alert("Invalid PIN. Try '1234'");
                }
            };

            const refreshData = async () => {
                try {
                    const l = await api('getLeagues');
                    setLeaguesList(l);
                    if (l.length > 0 && !teamForm.league_id) setTeamForm(prev => ({ ...prev, league_id: l[0].id.toString() }));
                } catch (e) { console.error(e); alert("Failed to load data"); }
            };

            useEffect(() => {
                if (authorized && teamForm.league_id) {
                    api('getTeams', { leagueId: parseInt(teamForm.league_id) }).then(setTeamsList).catch(console.error);
                }
            }, [authorized, teamForm.league_id]);

            useEffect(() => {
                if (authorized && selectedTeamForHistory) {
                    api('getMatchHistory', { teamId: parseInt(selectedTeamForHistory) })
                        .then(history => {
                            if (history.length > 0) {
                                setMatchHistory(history);
                            } else {
                                // Reset to empty 5 matches
                                setMatchHistory(Array(5).fill().map((_, i) => ({
                                    match_number: i + 1,
                                    goals_scored: 0,
                                    goals_conceded: 0,
                                    was_home: 1,
                                    points: 0
                                })));
                            }
                        })
                        .catch(console.error);
                }
            }, [authorized, selectedTeamForHistory]);

            const submitLeague = async () => {
                const action = editingLeagueId ? 'updateLeague' : 'createLeague';
                await api(action, { id: editingLeagueId, ...leagueForm });
                setEditingLeagueId(null);
                setLeagueForm({ name: '', avgHome: 1.5, avgAway: 1.2 });
                refreshData();
            };

            const submitTeam = async () => {
                const action = editingTeamId ? 'updateTeam' : 'createTeam';
                await api(action, { id: editingTeamId, ...teamForm });
                setEditingTeamId(null);
                setTeamForm(prev => ({ ...prev, name: '', home_goals_for: 0, home_goals_against: 0, home_games_played: 0, away_goals_for: 0, away_goals_against: 0, away_games_played: 0 }));
                api('getTeams', { leagueId: parseInt(teamForm.league_id) }).then(setTeamsList);
            };

            const handleDeleteTeam = async (id) => {
                if(confirm('Delete team?')) {
                    await api('deleteTeam', { teamId: id });
                    api('getTeams', { leagueId: parseInt(teamForm.league_id) }).then(setTeamsList);
                }
            };

            const updateMatchHistory = (index, field, value) => {
                const updated = [...matchHistory];
                updated[index][field] = parseInt(value) || 0;
                
                // Auto-calculate points
                if (field === 'goals_scored' || field === 'goals_conceded') {
                    const gs = field === 'goals_scored' ? (parseInt(value) || 0) : updated[index].goals_scored;
                    const gc = field === 'goals_conceded' ? (parseInt(value) || 0) : updated[index].goals_conceded;
                    if (gs > gc) updated[index].points = 3;
                    else if (gs === gc) updated[index].points = 1;
                    else updated[index].points = 0;
                }
                
                setMatchHistory(updated);
            };

            const saveMatchHistory = async () => {
                if (!selectedTeamForHistory) {
                    alert('Please select a team');
                    return;
                }
                try {
                    await api('saveMatchHistory', {
                        teamId: parseInt(selectedTeamForHistory),
                        matches: matchHistory
                    });
                    alert('Match history saved successfully!');
                } catch (e) {
                    console.error(e);
                    alert('Failed to save match history');
                }
            };

            if (!authorized) {
                return React.createElement('div', { className: "flex flex-col items-center justify-center min-h-[60vh] gap-4" },
                    React.createElement(ShieldCheck, { className: "w-16 h-16 text-slate-700" }),
                    React.createElement('h2', { className: "text-2xl font-bold" }, "Admin Access"),
                    React.createElement('div', { className: "flex gap-2" },
                        React.createElement('input', { type: "password", placeholder: "PIN", className: "bg-slate-900 border border-slate-800 rounded px-4 py-2 text-white", value: pin, onChange: (e) => setPin(e.target.value) }),
                        React.createElement('button', { onClick: handleAuth, className: "bg-neon-500 text-black font-bold px-4 py-2 rounded" }, "Access")
                    )
                );
            }

            return React.createElement('div', { className: "space-y-8" },
                React.createElement('div', { className: "flex items-center justify-between border-b border-slate-800 pb-4" },
                    React.createElement('h1', { className: "text-3xl font-bold flex items-center gap-2" }, React.createElement(Database, { className: "text-neon-500" }), "Database Management"),
                    React.createElement('div', { className: "flex bg-slate-900 p-1 rounded-lg" },
                        React.createElement('button', { onClick: () => setActiveTab('leagues'), className: `px-4 py-2 rounded text-sm font-medium ${activeTab === 'leagues' ? 'bg-slate-800 text-white' : 'text-slate-500'}` }, "Leagues"),
                        React.createElement('button', { onClick: () => setActiveTab('teams'), className: `px-4 py-2 rounded text-sm font-medium ${activeTab === 'teams' ? 'bg-slate-800 text-white' : 'text-slate-500'}` }, "Teams"),
                        React.createElement('button', { onClick: () => setActiveTab('history'), className: `px-4 py-2 rounded text-sm font-medium ${activeTab === 'history' ? 'bg-slate-800 text-white' : 'text-slate-500'}` }, "Match History")
                    )
                ),
                activeTab === 'leagues' ? React.createElement('div', { className: "grid md:grid-cols-2 gap-8" },
                    React.createElement('div', { className: "bg-slate-900 border border-slate-800 p-6 rounded-xl space-y-4" },
                        React.createElement('h3', { className: "text-xl font-bold text-white mb-4" }, editingLeagueId ? 'Edit League' : 'Add League'),
                        React.createElement('input', { placeholder: "Name", className: "w-full bg-slate-950 border border-slate-700 p-3 rounded text-white", value: leagueForm.name, onChange: (e) => setLeagueForm({...leagueForm, name: e.target.value}) }),
                        React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                            React.createElement('input', { type: "number", step: "0.1", placeholder: "Avg Home Goals", className: "bg-slate-950 border border-slate-700 p-3 rounded text-white", value: leagueForm.avgHome, onChange: (e) => setLeagueForm({...leagueForm, avgHome: parseFloat(e.target.value)}) }),
                            React.createElement('input', { type: "number", step: "0.1", placeholder: "Avg Away Goals", className: "bg-slate-950 border border-slate-700 p-3 rounded text-white", value: leagueForm.avgAway, onChange: (e) => setLeagueForm({...leagueForm, avgAway: parseFloat(e.target.value)}) })
                        ),
                        React.createElement('button', { onClick: submitLeague, className: "w-full bg-neon-500 text-black font-bold py-3 rounded" }, editingLeagueId ? 'Update' : 'Create')
                    ),
                    React.createElement('div', { className: "bg-slate-900 border border-slate-800 rounded-xl overflow-hidden" },
                        React.createElement('table', { className: "w-full text-left" },
                            React.createElement('thead', { className: "bg-slate-950 text-slate-500 text-xs uppercase" }, React.createElement('tr', null, React.createElement('th', { className: "p-4" }, "Name"), React.createElement('th', { className: "p-4 text-right" }, "Edit"))),
                            React.createElement('tbody', { className: "divide-y divide-slate-800" }, leaguesList.map(l => 
                                React.createElement('tr', { key: l.id }, React.createElement('td', { className: "p-4" }, l.name), React.createElement('td', { className: "p-4 text-right" }, 
                                    React.createElement('button', { onClick: () => { setLeagueForm({name: l.name, avgHome: l.avg_home_goals, avgAway: l.avg_away_goals}); setEditingLeagueId(l.id); }, className: "text-neon-500" }, React.createElement(Pencil, { className: "w-4 h-4" }))
                                )                                )
                            ))
                        )
                    )
                ) : activeTab === 'teams' ? React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-3 gap-8" },
                    React.createElement('div', { className: "lg:col-span-1 bg-slate-900 border border-slate-800 p-6 rounded-xl space-y-4" },
                        React.createElement('select', { className: "w-full bg-slate-950 border border-slate-700 p-3 rounded text-white", value: teamForm.league_id, onChange: (e) => setTeamForm({...teamForm, league_id: e.target.value}) }, leaguesList.map(l => React.createElement('option', { key: l.id, value: l.id }, l.name))),
                        React.createElement('input', { placeholder: "Team Name", className: "w-full bg-slate-950 border border-slate-700 p-3 rounded text-white", value: teamForm.name, onChange: (e) => setTeamForm({...teamForm, name: e.target.value}) }),
                        
                        React.createElement('div', { className: "pt-2 border-t border-slate-800" },
                            React.createElement('label', { className: "text-xs font-bold text-neon-500 uppercase mb-2 block" }, "Home Stats"),
                            React.createElement('div', { className: "grid grid-cols-3 gap-2" },
                                React.createElement('div', { className: "space-y-1" }, React.createElement('span', { className: "text-[10px] text-slate-500" }, "GF"), React.createElement('input', { type: "number", className: "w-full bg-slate-950 border border-slate-700 p-2 rounded text-sm text-white", value: teamForm.home_goals_for, onChange: (e) => setTeamForm({...teamForm, home_goals_for: parseInt(e.target.value) || 0}) })),
                                React.createElement('div', { className: "space-y-1" }, React.createElement('span', { className: "text-[10px] text-slate-500" }, "GA"), React.createElement('input', { type: "number", className: "w-full bg-slate-950 border border-slate-700 p-2 rounded text-sm text-white", value: teamForm.home_goals_against, onChange: (e) => setTeamForm({...teamForm, home_goals_against: parseInt(e.target.value) || 0}) })),
                                React.createElement('div', { className: "space-y-1" }, React.createElement('span', { className: "text-[10px] text-slate-500" }, "GP"), React.createElement('input', { type: "number", className: "w-full bg-slate-950 border border-slate-700 p-2 rounded text-sm text-white", value: teamForm.home_games_played, onChange: (e) => setTeamForm({...teamForm, home_games_played: parseInt(e.target.value) || 0}) }))
                            )
                        ),
                        React.createElement('div', { className: "pt-2 border-t border-slate-800" },
                            React.createElement('label', { className: "text-xs font-bold text-red-400 uppercase mb-2 block" }, "Away Stats"),
                            React.createElement('div', { className: "grid grid-cols-3 gap-2" },
                                React.createElement('div', { className: "space-y-1" }, React.createElement('span', { className: "text-[10px] text-slate-500" }, "GF"), React.createElement('input', { type: "number", className: "w-full bg-slate-950 border border-slate-700 p-2 rounded text-sm text-white", value: teamForm.away_goals_for, onChange: (e) => setTeamForm({...teamForm, away_goals_for: parseInt(e.target.value) || 0}) })),
                                React.createElement('div', { className: "space-y-1" }, React.createElement('span', { className: "text-[10px] text-slate-500" }, "GA"), React.createElement('input', { type: "number", className: "w-full bg-slate-950 border border-slate-700 p-2 rounded text-sm text-white", value: teamForm.away_goals_against, onChange: (e) => setTeamForm({...teamForm, away_goals_against: parseInt(e.target.value) || 0}) })),
                                React.createElement('div', { className: "space-y-1" }, React.createElement('span', { className: "text-[10px] text-slate-500" }, "GP"), React.createElement('input', { type: "number", className: "w-full bg-slate-950 border border-slate-700 p-2 rounded text-sm text-white", value: teamForm.away_games_played, onChange: (e) => setTeamForm({...teamForm, away_games_played: parseInt(e.target.value) || 0}) }))
                            )
                        ),

                        React.createElement('button', { onClick: submitTeam, className: "w-full bg-neon-500 text-black font-bold py-3 rounded mt-4" }, editingTeamId ? 'Update' : 'Add Team')
                    ),
                    React.createElement('div', { className: "lg:col-span-2 bg-slate-900 border border-slate-800 rounded-xl overflow-hidden" },
                        React.createElement('table', { className: "w-full text-left" },
                            React.createElement('thead', { className: "bg-slate-950 text-slate-500 text-xs uppercase" }, React.createElement('tr', null, 
                                React.createElement('th', { className: "p-4" }, "Team"), 
                                React.createElement('th', { className: "p-4 text-center" }, "Home (GF/GA/GP)"),
                                React.createElement('th', { className: "p-4 text-center" }, "Away (GF/GA/GP)"),
                                React.createElement('th', { className: "p-4 text-right" }, "Actions")
                            )),
                            React.createElement('tbody', { className: "divide-y divide-slate-800" }, teamsList.map(t => 
                                React.createElement('tr', { key: t.id }, 
                                    React.createElement('td', { className: "p-4" }, t.name), 
                                    React.createElement('td', { className: "p-4 text-center text-slate-400 font-mono" }, `${t.home_goals_for}/${t.home_goals_against}/${t.home_games_played}`),
                                    React.createElement('td', { className: "p-4 text-center text-slate-400 font-mono" }, `${t.away_goals_for}/${t.away_goals_against}/${t.away_games_played}`),
                                    React.createElement('td', { className: "p-4 text-right" }, 
                                        React.createElement('button', { onClick: () => { setTeamForm({...t, league_id: t.league_id.toString()}); setEditingTeamId(t.id); }, className: "text-neon-500 mr-2" }, React.createElement(Pencil, { className: "w-4 h-4" })),
                                        React.createElement('button', { onClick: () => handleDeleteTeam(t.id), className: "text-red-500" }, React.createElement(Trash2, { className: "w-4 h-4" }))
                                    )
                                )
                            ))
                        )
                    )
                )
            );
        }

        function App() {
            const [path, setPath] = useState(window.location.pathname);
            useEffect(() => {
                const onPopState = () => setPath(window.location.pathname);
                window.addEventListener('popstate', onPopState);
                return () => window.removeEventListener('popstate', onPopState);
            }, []);
            const navigate = (newPath) => {
                window.history.pushState({}, '', newPath);
                setPath(newPath);
            };
            const PageComponent = path === '/admin' ? AdminPage : HomePage;

            return React.createElement(React.Fragment, null,
                React.createElement('nav', { className: "border-b border-slate-800 bg-slate-950/50 backdrop-blur-md sticky top-0 z-50" },
                    React.createElement('div', { className: "max-w-6xl mx-auto px-6 h-16 flex items-center justify-between" },
                        React.createElement('a', { href: "/", onClick: (e) => { e.preventDefault(); navigate('/'); }, className: "text-xl font-bold tracking-tight text-white flex items-center gap-2" },
                            React.createElement('div', { className: "w-3 h-3 bg-neon-400 rounded-full shadow-[0_0_10px_#4ade80]" }), "NEON", React.createElement('span', { className: "text-slate-500" }, "PREDICT")
                        ),
                        React.createElement('div', { className: "flex gap-6 text-sm font-medium" },
                            React.createElement('a', { href: "/", onClick: (e) => { e.preventDefault(); navigate('/'); }, className: clsx("transition-colors", path === '/' ? "text-neon-400" : "hover:text-neon-400") }, "Calculator"),
                            React.createElement('a', { href: "/admin", onClick: (e) => { e.preventDefault(); navigate('/admin'); }, className: clsx("transition-colors", path === '/admin' ? "text-neon-400" : "hover:text-neon-400") }, "Admin")
                        )
                    )
                ),
                React.createElement('main', { className: "max-w-6xl mx-auto p-6" }, React.createElement(PageComponent))
            );
        }

        const rootEl = document.getElementById('root');
        if (rootEl) createRoot(rootEl).render(React.createElement(App));
    </script>
</body>
</html>